//@version=5
indicator("XL Sector", overlay=true)

//  Manual GICS Overrides (Ticker → SPDR Sector)
gicsOverride = switch syminfo.ticker
    "AAPL" => "XLK"   
    "RPRX" => "XLV"  
    "TSLA" => "XLY"
    "VRSN" => "XLK"
    "AFRM" => "XLK"
    "AGRO" => "XLP"
    "AMR"  => "XLB"
    "AMTX" => "XLE"
    "ATVI" => "XLC"
    "AVTR" => "XLB"
    "ATOM" => "XLP"
    "ATER" => "XLK"
    "APOG" => "XLY"
    "ARCE" => "XLP"
    "AVNW" => "XLK"
    "AUDC" => "XLK"
    => ""


// Industry → SPDR Sector Mapping
_industry = syminfo.industry

_spdr_industry = switch _industry
    "Semiconductors"                    => "XLK"
    "Computer Communications"           => "XLK"
    "Electronics/Appliances"            => "XLK"
    "Software"                          => "XLK"
    "Information Technology Services"   => "XLK"
    "Computer Peripherals"              => "XLK"
    "Electronic Components"             => "XLK"
    "Electronics Distributors"          => "XLK"
    "Packaged Software"                 => "XLK"
    "Data Processing Services"          => "XLK"

    "Telecommunications"                => "XLC"
    "Specialty Telecommunications"      => "XLC"
    "Telecommunications Equipment"      => "XLC"
    "Cable/Satellite TV"                => "XLC"
    "Media"                             => "XLC"
    "Movies/Entertainment"              => "XLC"
    "Interactive Media"                 => "XLC"
    "Internet Software/Services"        => "XLC"
    "Wireless Telecommunications"       => "XLC"
    "Hotels/Resorts/Cruise lines"       => "XLC"

    "Biotechnology"                     => "XLV"
    "Pharmaceuticals"                   => "XLV"
    "Medical Specialties"               => "XLV"
    "Healthcare Services"               => "XLV"
    "Managed Health Care"               => "XLV"
    "Hospital/Nursing Management"       => "XLV"
    "Pharmaceuticals: Major"            => "XLV"
    "Engineering & Construction"        => "XLV"
    "Pharmaceuticals: Generic"          => "XLV"
    "Pharmaceuticals: Other"            => "XLV"
    "Drugstore Chains"                  => "XLV"
    "Medical Distributors"              => "XLV"
    "Personnel Services"                => "XLV"
    "Medical/Nursing Services"          => "XLV"

    "Retail"                            => "XLY"
    "Specialty Stores"                  => "XLY"
    "Autos"                             => "XLY"
    "Recreational Products"             => "XLY"
    "Building Products"                 => "XLY"
    "Auto Parts: OEM"                   => "XLY"
    "Apparel/Footwear Retail"           => "XLY"
    "Department Stores"                  => "XLY"
    "Consumer Durables"                 => "XLY"
    "Internet Retail"                   => "XLY"
    "Containers/Packaging"              => "XLY"
    "Hotels/Entertainment"              => "XLY"

    "Food Products"                     => "XLP"
    "Beverages"                         => "XLP"
    "Agricultural Commodities/Milling"  => "XLP"
    "Food Retail"                       => "XLP"
    "Miscellaneous Commercial Services" => "XLP"
    "Other Consumer Services"           => "XLP"
    "Household/Personal Care"           => "XLP"

    "Banks"                             => "XLF"
    "Insurance"                         => "XLF"
    "Financial Conglomerates"           => "XLF"
    "Investment Banks/Brokers"          => "XLF"
    "Multi-Line Insurance"              => "XLF"
    "Regional Banks"                    => "XLF"
    "Investment Management"             => "XLF"
    "Major Banks"                       => "XLF"
    "Investment Managers"               => "XLF"
    "Specialty Insurance"               => "XLF"
    "Property/Casualty Insurance"       => "XLF"
    "Insurance Brokers/Services"        => "XLF"


    "Oil & Gas"                         => "XLE"
    "Oilfield Services"                 => "XLE"
    "Oil & Gas Pipelines"               => "XLE"
    "Integrated Oil"                    => "XLE"
    "Coal"                              => "XLE"

    "Aerospace & Defense"               => "XLI"
    "Industrial Machinery"              => "XLI"
    "Electrical Products"               => "XLI"
    "Pulp & Paper"                      => "XLI"
    "Metal Fabrication"                 => "XLI"
    "Miscellaneous Manufacturing"       => "XLI"
    "Construction"                      => "XLI"
    "Finance/Rental/Leasing"            => "XLI"
    "Tools & Hardware"                  => "XLI"
    "Transportation"                    => "XLI"
    "Industrial Specialties"            => "XLI"
    "Trucking"                          => "XLI"
    "Other Metals/Minerals"             => "XLI"
    "Trucks/Construction/Farm Machinery" => "XLI"
    "Airlines"                          => "XLI"
    "Wholesale Distributors"            => "XLI"
    "Marine Shipping"                   => "XLI"
    "Motor Vehicles"                    => "XLI"

    "Chemicals"                         => "XLB"
    "Metals & Mining"                   => "XLB"
    "Chemicals: Specialty"              => "XLB"
    "Food: Specialty/Candy"             => "XLB"
    "Paper & Forest Products"           => "XLB"
    "Construction Materials"            => "XLB"
    "Aluminum"                          => "XLB"

    "Real Estate Development"           => "XLRE"
    "Real Estate Investment Trusts"     => "XLRE"

    "Utilities"                         => "XLU"
    "Electric Utilities"                => "XLU"
    "Water Utilities"                   => "XLU"
    "Alternative Power Generation"      => "XLU"

    "Precious Metals"                   => "XLB"

    "Investment Trusts/Mutual Funds"    => "ETF"
    => "UNKNOWN"



// Final Sector (Override > Industry)
_spdr = gicsOverride != "" ? gicsOverride : _spdr_industry

//  Display
var table corner = table.new(position.bottom_right, 1, 1, border_width = 1)
if barstate.islast
    table.cell(corner, 0, 0, _spdr, text_color=color.white, text_size=size.large)
